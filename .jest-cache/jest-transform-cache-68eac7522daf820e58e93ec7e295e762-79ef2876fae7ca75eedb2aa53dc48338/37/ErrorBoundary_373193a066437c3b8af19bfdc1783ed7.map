{"version":3,"sources":["/Users/joshszep/code/therobotoverlord-mono/therobotoverlord-web/src/components/ui/ErrorBoundary.tsx"],"sourcesContent":["/**\n * Error Boundary Components for The Robot Overlord\n * Catches JavaScript errors in component trees and displays fallback UI\n */\n\n'use client';\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\nimport { Button } from './Button';\nimport { Card, CardContent, CardHeader, CardTitle } from './Card';\nimport { ErrorState, ConnectionErrorState } from './EmptyState';\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: ReactNode;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  showDetails?: boolean;\n  resetOnPropsChange?: boolean;\n  resetKeys?: Array<string | number>;\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  private resetTimeoutId: number | null = null;\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\n    \n    this.setState({\n      error,\n      errorInfo,\n    });\n\n    // Call the onError callback if provided\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n\n    // Report error to monitoring service (if available)\n    if (typeof window !== 'undefined' && (window as any).reportError) {\n      (window as any).reportError(error);\n    }\n  }\n\n  componentDidUpdate(prevProps: ErrorBoundaryProps) {\n    const { resetOnPropsChange, resetKeys } = this.props;\n    const { hasError } = this.state;\n\n    // Reset error boundary when resetKeys change\n    if (hasError && resetKeys && prevProps.resetKeys) {\n      const hasResetKeyChanged = resetKeys.some(\n        (resetKey, idx) => prevProps.resetKeys![idx] !== resetKey\n      );\n      \n      if (hasResetKeyChanged) {\n        this.resetErrorBoundary();\n      }\n    }\n\n    // Reset error boundary when any props change (if enabled)\n    if (hasError && resetOnPropsChange && prevProps !== this.props) {\n      this.resetErrorBoundary();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n  }\n\n  resetErrorBoundary = () => {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    });\n  };\n\n  handleRetry = () => {\n    this.resetErrorBoundary();\n  };\n\n  render() {\n    const { hasError, error, errorInfo } = this.state;\n    const { children, fallback, showDetails = false } = this.props;\n\n    if (hasError) {\n      // Use custom fallback if provided\n      if (fallback) {\n        return fallback;\n      }\n\n      // Default error UI\n      return (\n        <div className=\"min-h-[400px] flex items-center justify-center p-6\">\n          <Card className=\"max-w-lg w-full\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2 text-rejected-red\">\n                <span className=\"text-2xl\">‚ö†Ô∏è</span>\n                <span>Something went wrong</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p className=\"text-muted-light\">\n                An unexpected error occurred. This has been reported to our team.\n              </p>\n              \n              {showDetails && error && (\n                <div className=\"bg-muted/20 p-3 rounded-md\">\n                  <details>\n                    <summary className=\"cursor-pointer text-sm font-medium text-light-text mb-2\">\n                      Error Details\n                    </summary>\n                    <div className=\"text-xs text-muted-light font-mono space-y-2\">\n                      <div>\n                        <strong>Error:</strong> {error.message}\n                      </div>\n                      {error.stack && (\n                        <div>\n                          <strong>Stack:</strong>\n                          <pre className=\"whitespace-pre-wrap mt-1\">{error.stack}</pre>\n                        </div>\n                      )}\n                      {errorInfo && errorInfo.componentStack && (\n                        <div>\n                          <strong>Component Stack:</strong>\n                          <pre className=\"whitespace-pre-wrap mt-1\">{errorInfo.componentStack}</pre>\n                        </div>\n                      )}\n                    </div>\n                  </details>\n                </div>\n              )}\n              \n              <div className=\"flex space-x-3\">\n                <Button variant=\"primary\" onClick={this.handleRetry}>\n                  Try Again\n                </Button>\n                <Button \n                  variant=\"ghost\" \n                  onClick={() => window.location.reload()}\n                >\n                  Reload Page\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return children;\n  }\n}\n\n// Hook-based error boundary for functional components\nexport function useErrorHandler() {\n  return (error: Error, errorInfo?: ErrorInfo) => {\n    console.error('Error caught by useErrorHandler:', error, errorInfo);\n    \n    // Report to monitoring service\n    if (typeof window !== 'undefined' && (window as any).reportError) {\n      (window as any).reportError(error);\n    }\n  };\n}\n\n// Higher-order component for wrapping components with error boundary\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  errorBoundaryProps?: Omit<ErrorBoundaryProps, 'children'>\n) {\n  const WrappedComponent = (props: P) => (\n    <ErrorBoundary {...errorBoundaryProps}>\n      <Component {...props} />\n    </ErrorBoundary>\n  );\n\n  WrappedComponent.displayName = `withErrorBoundary(${Component.displayName || Component.name})`;\n  \n  return WrappedComponent;\n}\n\n// Specific error boundaries for different contexts\nexport function PageErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      showDetails={process.env.NODE_ENV === 'development'}\n      fallback={\n        <div className=\"min-h-screen flex items-center justify-center\">\n          <ErrorState\n            title=\"Page Error\"\n            description=\"This page encountered an error and couldn't be displayed properly.\"\n            onRetry={() => window.location.reload()}\n          />\n        </div>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function ComponentErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      fallback={\n        <div className=\"p-4 border border-rejected-red/20 rounded-lg bg-rejected-red/5\">\n          <div className=\"flex items-center space-x-2 text-rejected-red mb-2\">\n            <span>‚ö†Ô∏è</span>\n            <span className=\"font-medium\">Component Error</span>\n          </div>\n          <p className=\"text-sm text-muted-light\">\n            This component failed to load properly.\n          </p>\n        </div>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function AsyncErrorBoundary({ \n  children, \n  onRetry \n}: { \n  children: ReactNode; \n  onRetry?: () => void; \n}) {\n  return (\n    <ErrorBoundary\n      fallback={\n        <ConnectionErrorState onRetry={onRetry} />\n      }\n      resetOnPropsChange={true}\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function FormErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      fallback={\n        <div className=\"p-4 border border-rejected-red/20 rounded-lg bg-rejected-red/5\">\n          <div className=\"flex items-center space-x-2 text-rejected-red mb-2\">\n            <span>‚ö†Ô∏è</span>\n            <span className=\"font-medium\">Form Error</span>\n          </div>\n          <p className=\"text-sm text-muted-light mb-3\">\n            The form encountered an error. Please refresh the page and try again.\n          </p>\n          <Button \n            variant=\"secondary\" \n            size=\"sm\"\n            onClick={() => window.location.reload()}\n          >\n            Refresh Page\n          </Button>\n        </div>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\nexport function ChatErrorBoundary({ \n  children, \n  onReset \n}: { \n  children: ReactNode; \n  onReset?: () => void; \n}) {\n  return (\n    <ErrorBoundary\n      fallback={\n        <div className=\"p-4 text-center\">\n          <div className=\"text-4xl mb-2\">ü§ñ</div>\n          <h3 className=\"font-bold text-light-text mb-2\">Chat Error</h3>\n          <p className=\"text-sm text-muted-light mb-4\">\n            The chat system encountered an error. Try reconnecting.\n          </p>\n          <Button variant=\"primary\" size=\"sm\" onClick={onReset}>\n            Reconnect Chat\n          </Button>\n        </div>\n      }\n      resetOnPropsChange={true}\n    >\n      {children}\n    </ErrorBoundary>\n  );\n}\n\n// Global error handler for unhandled promise rejections\nexport function setupGlobalErrorHandlers() {\n  if (typeof window !== 'undefined') {\n    // Handle unhandled promise rejections\n    window.addEventListener('unhandledrejection', (event) => {\n      console.error('Unhandled promise rejection:', event.reason);\n      \n      // Report to monitoring service\n      if ((window as any).reportError) {\n        (window as any).reportError(new Error(`Unhandled Promise Rejection: ${event.reason}`));\n      }\n      \n      // Prevent the default browser behavior\n      event.preventDefault();\n    });\n\n    // Handle global errors\n    window.addEventListener('error', (event) => {\n      console.error('Global error:', event.error);\n      \n      // Report to monitoring service\n      if ((window as any).reportError) {\n        (window as any).reportError(event.error);\n      }\n    });\n  }\n}\n\n// Error reporting utility\nexport function reportError(error: Error, context?: string) {\n  console.error(`Error in ${context || 'unknown context'}:`, error);\n  \n  // Report to monitoring service\n  if (typeof window !== 'undefined' && (window as any).reportError) {\n    (window as any).reportError(error);\n  }\n  \n  // In development, you might want to show more details\n  if (process.env.NODE_ENV === 'development') {\n    console.trace('Error trace:', error);\n  }\n}\n"],"names":["AsyncErrorBoundary","ChatErrorBoundary","ComponentErrorBoundary","ErrorBoundary","FormErrorBoundary","PageErrorBoundary","reportError","setupGlobalErrorHandlers","useErrorHandler","withErrorBoundary","Component","props","resetTimeoutId","resetErrorBoundary","clearTimeout","setState","hasError","error","errorInfo","handleRetry","state","getDerivedStateFromError","componentDidCatch","console","onError","window","componentDidUpdate","prevProps","resetOnPropsChange","resetKeys","hasResetKeyChanged","some","resetKey","idx","componentWillUnmount","render","children","fallback","showDetails","div","className","Card","CardHeader","CardTitle","span","CardContent","p","details","summary","strong","message","stack","pre","componentStack","Button","variant","onClick","location","reload","errorBoundaryProps","WrappedComponent","displayName","name","process","env","NODE_ENV","ErrorState","title","description","onRetry","ConnectionErrorState","size","onReset","h3","addEventListener","event","reason","Error","preventDefault","context","trace"],"mappings":"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"}