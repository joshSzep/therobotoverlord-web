{"version":3,"sources":["/Users/joshszep/code/therobotoverlord-mono/therobotoverlord-web/src/__tests__/integration/websocket.integration.test.tsx"],"sourcesContent":["import React from 'react'\nimport { render, screen, waitFor } from '@testing-library/react'\nimport { act } from 'react'\nimport userEvent from '@testing-library/user-event'\nimport { createMockPost, createMockUser } from '@/__tests__/utils/test-utils'\n\n// Mock WebSocket\nconst MockWebSocketInstances: MockWebSocket[] = []\n\nclass MockWebSocket {\n  static CONNECTING = 0\n  static OPEN = 1\n  static CLOSING = 2\n  static CLOSED = 3\n\n  url: string\n  readyState: number = MockWebSocket.CONNECTING\n  onopen: ((event: Event) => void) | null = null\n  onclose: ((event: CloseEvent) => void) | null = null\n  onmessage: ((event: MessageEvent) => void) | null = null\n  onerror: ((event: Event) => void) | null = null\n\n  constructor(url: string) {\n    this.url = url\n    MockWebSocketInstances.push(this)\n    // Simulate connection opening\n    setTimeout(() => {\n      this.readyState = MockWebSocket.OPEN\n      if (this.onopen) {\n        this.onopen(new Event('open'))\n      }\n    }, 10)\n  }\n\n  send(data: string) {\n    if (this.readyState !== MockWebSocket.OPEN) {\n      throw new Error('WebSocket is not open')\n    }\n    // Echo back for testing\n    setTimeout(() => {\n      if (this.onmessage) {\n        this.onmessage(new MessageEvent('message', { data }))\n      }\n    }, 50)\n  }\n\n  close() {\n    this.readyState = MockWebSocket.CLOSED\n    if (this.onclose) {\n      this.onclose(new CloseEvent('close'))\n    }\n  }\n\n  // Test helpers\n  simulateMessage(data: any) {\n    if (this.onmessage && this.readyState === MockWebSocket.OPEN) {\n      // Trigger immediately for tests\n      this.onmessage(new MessageEvent('message', { \n        data: typeof data === 'string' ? data : JSON.stringify(data)\n      }))\n    }\n  }\n\n  simulateError() {\n    if (this.onerror) {\n      this.onerror(new Event('error'))\n    }\n  }\n\n  simulateClose() {\n    this.readyState = MockWebSocket.CLOSED\n    if (this.onclose) {\n      this.onclose(new CloseEvent('close'))\n    }\n  }\n}\n\n// Create a Jest mock for WebSocket constructor\nconst MockWebSocketConstructor = jest.fn().mockImplementation((url: string) => {\n  return new MockWebSocket(url)\n})\n\n// Replace global WebSocket with mock\nglobal.WebSocket = MockWebSocketConstructor as any\n\n// Mock WebSocket context and provider\nconst MockWebSocketProvider = ({ children }: { children: React.ReactNode }) => {\n  const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n  const [isConnected, setIsConnected] = React.useState(false)\n  const [connectionStatus, setConnectionStatus] = React.useState<'connecting' | 'connected' | 'disconnected'>('disconnected')\n\n  const connect = React.useCallback(() => {\n    if (socket) return\n\n    const ws = new (global.WebSocket as any)('ws://localhost:3001')\n    \n    ws.onopen = () => {\n      setIsConnected(true)\n      setConnectionStatus('connected')\n    }\n\n    ws.onclose = () => {\n      setIsConnected(false)\n      setConnectionStatus('disconnected')\n      setSocket(null)\n    }\n\n    ws.onerror = () => {\n      setConnectionStatus('disconnected')\n      setIsConnected(false)\n    }\n\n    setSocket(ws)\n    setConnectionStatus('connecting')\n    \n    // Simulate connection opening after a brief delay\n    setTimeout(() => {\n      if (ws.onopen) ws.onopen(new Event('open'))\n    }, 10)\n  }, [socket])\n\n  // Auto-connect on mount\n  React.useEffect(() => {\n    connect()\n  }, [connect])\n\n  const disconnect = React.useCallback(() => {\n    if (socket) {\n      socket.close()\n    }\n  }, [socket])\n\n  const sendMessage = React.useCallback((message: any) => {\n    if (socket && isConnected) {\n      socket.send(JSON.stringify(message))\n    }\n  }, [socket, isConnected])\n\n  React.useEffect(() => {\n    connect()\n    return () => disconnect()\n  }, [connect, disconnect])\n\n  const contextValue = {\n    socket,\n    isConnected,\n    connectionStatus,\n    connect,\n    disconnect,\n    sendMessage\n  }\n\n  return (\n    <div data-testid=\"websocket-provider\">\n      {React.Children.map(children, child => \n        React.isValidElement(child) \n          ? React.cloneElement(child, { ...contextValue })\n          : child\n      )}\n    </div>\n  )\n}\n\n// Mock real-time chat component\nconst MockChatComponent = ({ \n  socket, \n  isConnected, \n  connectionStatus, \n  sendMessage \n}: any) => {\n  const [messages, setMessages] = React.useState<any[]>([])\n  const [inputValue, setInputValue] = React.useState('')\n\n  React.useEffect(() => {\n    if (!socket) return\n\n    const handleMessage = (event: MessageEvent) => {\n      try {\n        const data = JSON.parse(event.data)\n        if (data.type === 'message') {\n          setMessages(prev => [...prev, data.payload])\n        }\n      } catch (error) {\n        console.error('Failed to parse message:', error)\n      }\n    }\n\n    socket.onmessage = handleMessage\n\n    return () => {\n      if (socket.onmessage === handleMessage) {\n        socket.onmessage = null\n      }\n    }\n  }, [socket])\n\n  const handleSendMessage = () => {\n    if (inputValue.trim() && isConnected) {\n      const message = {\n        type: 'message',\n        payload: {\n          id: Date.now().toString(),\n          content: inputValue,\n          author: 'testuser',\n          timestamp: new Date().toISOString()\n        }\n      }\n      sendMessage(message)\n      setInputValue('')\n    }\n  }\n\n  return (\n    <div data-testid=\"chat-component\">\n      <div data-testid=\"connection-status\">\n        Status: {connectionStatus}\n      </div>\n      \n      <div data-testid=\"messages-container\">\n        {messages.map(msg => (\n          <div key={msg.id} data-testid={`message-${msg.id}`}>\n            <strong>{msg.author}:</strong> {msg.content}\n          </div>\n        ))}\n      </div>\n\n      <div data-testid=\"message-input-container\">\n        <input\n          data-testid=\"message-input\"\n          value={inputValue}\n          onChange={(e) => setInputValue(e.target.value)}\n          onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n          disabled={!isConnected}\n          placeholder={isConnected ? 'Type a message...' : 'Connecting...'}\n        />\n        <button\n          data-testid=\"send-button\"\n          onClick={handleSendMessage}\n          disabled={!isConnected || !inputValue.trim()}\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  )\n}\n\n// Mock live updates component\nconst MockLiveUpdatesComponent = ({ socket, isConnected }: any) => {\n  const [posts, setPosts] = React.useState<any[]>([])\n  const [notifications, setNotifications] = React.useState<any[]>([])\n\n  React.useEffect(() => {\n    if (!socket) return\n\n    const handleMessage = (event: MessageEvent) => {\n      try {\n        let data\n        if (typeof event.data === 'string') {\n          data = JSON.parse(event.data)\n        } else {\n          data = event.data\n        }\n        \n        switch (data.type) {\n          case 'new_post':\n            setPosts(prev => [data.payload, ...prev])\n            break\n          case 'post_updated':\n            setPosts(prev => prev.map(post => \n              post.id === data.payload.id ? data.payload : post\n            ))\n            break\n          case 'notification':\n            setNotifications(prev => [data.payload, ...prev])\n            break\n        }\n      } catch (error) {\n        console.error('Failed to parse live update:', error)\n      }\n    }\n\n    socket.onmessage = handleMessage\n\n    return () => {\n      if (socket.onmessage === handleMessage) {\n        socket.onmessage = null\n      }\n    }\n  }, [socket])\n\n  return (\n    <div data-testid=\"live-updates\">\n      <div data-testid=\"live-posts\">\n        {posts.map(post => (\n          <div key={post.id} data-testid={`live-post-${post.id}`}>\n            {post.title}\n          </div>\n        ))}\n      </div>\n      \n      <div data-testid=\"live-notifications\">\n        {notifications.map(notification => (\n          <div key={notification.id} data-testid={`notification-${notification.id}`}>\n            {notification.message}\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\ndescribe('WebSocket Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n    MockWebSocketInstances.length = 0\n  })\n\n  describe('Connection Management', () => {\n    it('establishes WebSocket connection on mount', async () => {\n      render(\n        <MockWebSocketProvider>\n          <div data-testid=\"test-component\" />\n        </MockWebSocketProvider>\n      )\n\n      expect(screen.getByTestId('websocket-provider')).toBeInTheDocument()\n\n      // Wait for connection to establish\n      await waitFor(() => {\n        // Connection should be established automatically\n        expect(MockWebSocketConstructor).toHaveBeenCalledWith('ws://localhost:3001')\n      }, { timeout: 200 })\n    })\n\n    it('shows connection status changes', async () => {\n      render(\n        <MockWebSocketProvider>\n          <MockChatComponent />\n        </MockWebSocketProvider>\n      )\n\n      // Initially connecting\n      expect(screen.getByTestId('connection-status')).toHaveTextContent('Status: connecting')\n\n      // Wait for connection to open\n      await waitFor(() => {\n        expect(screen.getByTestId('connection-status')).toHaveTextContent('Status: connected')\n      }, { timeout: 200 })\n    })\n\n    it('handles connection errors', async () => {\n      const TestComponent = ({ socket }: any) => {\n        const [error, setError] = React.useState('')\n\n        React.useEffect(() => {\n          if (socket) {\n            socket.onerror = () => setError('Connection failed')\n          }\n        }, [socket])\n\n        return (\n          <div>\n            {error && <div data-testid=\"connection-error\">{error}</div>}\n          </div>\n        )\n      }\n\n      render(\n        <MockWebSocketProvider>\n          <TestComponent />\n        </MockWebSocketProvider>\n      )\n\n      // Wait for socket to be created, then simulate error\n      await waitFor(() => {\n        const provider = screen.getByTestId('websocket-provider')\n        expect(provider).toBeInTheDocument()\n      })\n\n      // Simulate connection error\n      await act(async () => {\n        // This would be triggered by the mock WebSocket\n        const mockSocket = new MockWebSocket('ws://localhost:3001')\n        mockSocket.simulateError()\n      })\n    })\n\n    it('reconnects on connection loss', async () => {\n      const TestComponent = ({ socket, connect, connectionStatus }: any) => {\n        React.useEffect(() => {\n          if (connectionStatus === 'disconnected' && !socket) {\n            // Auto-reconnect logic\n            setTimeout(connect, 1000)\n          }\n        }, [connectionStatus, socket, connect])\n\n        return (\n          <div data-testid=\"connection-status\">\n            Status: {connectionStatus}\n          </div>\n        )\n      }\n\n      render(\n        <MockWebSocketProvider>\n          <TestComponent />\n        </MockWebSocketProvider>\n      )\n\n      // Wait for initial connection\n      await waitFor(() => {\n        expect(screen.getByTestId('connection-status')).toHaveTextContent('Status: connected')\n      })\n\n      // Simulate connection loss\n      await act(async () => {\n        const mockSocket = new MockWebSocket('ws://localhost:3001')\n        mockSocket.simulateClose()\n      })\n    })\n  })\n\n  describe('Real-time Chat', () => {\n    it('sends and receives chat messages', async () => {\n      const user = userEvent.setup()\n      \n      render(\n        <MockWebSocketProvider>\n          <MockChatComponent />\n        </MockWebSocketProvider>\n      )\n\n      // Wait for connection\n      await waitFor(() => {\n        expect(screen.getByTestId('connection-status')).toHaveTextContent('Status: connected')\n      })\n\n      // Type and send message\n      const input = screen.getByTestId('message-input')\n      const sendButton = screen.getByTestId('send-button')\n\n      await user.type(input, 'Hello, world!')\n      await user.click(sendButton)\n\n      // Message should be sent and echoed back\n      await waitFor(() => {\n        const messagesContainer = screen.getByTestId('messages-container')\n        expect(messagesContainer.children.length).toBeGreaterThan(0)\n        expect(screen.getByText('testuser:')).toBeInTheDocument()\n        expect(screen.getByText('Hello, world!')).toBeInTheDocument()\n      })\n\n      // Input should be cleared\n      expect(input).toHaveValue('')\n    })\n\n    it('disables input when disconnected', async () => {\n      render(\n        <MockWebSocketProvider>\n          <MockChatComponent />\n        </MockWebSocketProvider>\n      )\n\n      const input = screen.getByTestId('message-input')\n      const sendButton = screen.getByTestId('send-button')\n\n      // Initially disabled while connecting\n      expect(input).toBeDisabled()\n      expect(sendButton).toBeDisabled()\n\n      // Wait for connection\n      await waitFor(() => {\n        expect(input).not.toBeDisabled()\n        expect(sendButton).toBeDisabled() // Still disabled due to empty input\n      })\n    })\n\n    it('handles message sending with Enter key', async () => {\n      const user = userEvent.setup()\n      \n      render(\n        <MockWebSocketProvider>\n          <MockChatComponent />\n        </MockWebSocketProvider>\n      )\n\n      await waitFor(() => {\n        expect(screen.getByTestId('connection-status')).toHaveTextContent('Status: connected')\n      })\n\n      const input = screen.getByTestId('message-input')\n      await user.type(input, 'Test message{enter}')\n\n      await waitFor(() => {\n        expect(screen.getByText('Test message')).toBeInTheDocument()\n      })\n    })\n  })\n\n  describe('Live Updates', () => {\n    it('receives and displays new posts', async () => {\n      let testSocket: MockWebSocket | null = null\n      \n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          testSocket = ws\n          setSocket(ws)\n          \n          // Wait for connection to open, then simulate message\n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN) {\n              ws.simulateMessage({\n                type: 'new_post',\n                payload: {\n                  id: '1',\n                  title: 'Live Post Update',\n                  content: 'Test content',\n                  author: 'testuser'\n                }\n              })\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      render(<TestComponent />)\n\n      await waitFor(() => {\n        expect(screen.getByText('Live Post Update')).toBeInTheDocument()\n      }, { timeout: 2000 })\n    })\n\n    it('receives and displays notifications', async () => {\n      let testSocket: MockWebSocket | null = null\n      \n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          testSocket = ws\n          setSocket(ws)\n          \n          // Wait for connection to open, then simulate message\n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN) {\n              ws.simulateMessage({\n                type: 'notification',\n                payload: {\n                  id: '1',\n                  message: 'New notification received'\n                }\n              })\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      render(<TestComponent />)\n\n      await waitFor(() => {\n        expect(screen.getByText('New notification received')).toBeInTheDocument()\n      }, { timeout: 2000 })\n    })\n\n    it('updates existing posts when modified', async () => {\n      let testSocket: MockWebSocket | null = null\n      \n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          testSocket = ws\n          setSocket(ws)\n          \n          // Wait for connection to open, then simulate messages\n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN) {\n              // First, add a post\n              ws.simulateMessage({\n                type: 'new_post',\n                payload: {\n                  id: '1',\n                  title: 'Original Title',\n                  content: 'Original content',\n                  author: 'testuser'\n                }\n              })\n              \n              // Then update it\n              setTimeout(() => {\n                ws.simulateMessage({\n                  type: 'post_updated',\n                  payload: {\n                    id: '1',\n                    title: 'Updated Title',\n                    content: 'Updated content',\n                    author: 'testuser'\n                  }\n                })\n              }, 10)\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      render(<TestComponent />)\n\n      // Wait for original post\n      await waitFor(() => {\n        expect(screen.getByText('Original Title')).toBeInTheDocument()\n      }, { timeout: 2000 })\n\n      // Wait for update\n      await waitFor(() => {\n        expect(screen.getByText('Updated Title')).toBeInTheDocument()\n        expect(screen.queryByText('Original Title')).not.toBeInTheDocument()\n      }, { timeout: 1000 })\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('handles malformed WebSocket messages', async () => {\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation()\n      \n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          setSocket(ws)\n          \n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN && ws.onmessage) {\n              // Send malformed JSON\n              ws.onmessage(new MessageEvent('message', { \n                data: 'invalid json' \n              }))\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      render(<TestComponent />)\n\n      await waitFor(() => {\n        expect(consoleSpy).toHaveBeenCalledWith(\n          'Failed to parse live update:',\n          expect.any(Error)\n        )\n      }, { timeout: 1000 })\n\n      consoleSpy.mockRestore()\n    })\n\n    it('gracefully handles unknown message types', async () => {\n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          setSocket(ws)\n          \n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN) {\n              ws.simulateMessage({\n                type: 'unknown_type',\n                payload: { data: 'test' }\n              })\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      render(<TestComponent />)\n\n      // Should not crash or show any error\n      await waitFor(() => {\n        expect(screen.getByTestId('live-updates')).toBeInTheDocument()\n      })\n    })\n  })\n\n  describe('Performance', () => {\n    it('handles high-frequency messages without performance issues', async () => {\n      const TestComponent = () => {\n        const [socket, setSocket] = React.useState<MockWebSocket | null>(null)\n        \n        React.useEffect(() => {\n          const ws = new MockWebSocket('ws://localhost:3001')\n          setSocket(ws)\n          \n          setTimeout(() => {\n            if (ws.readyState === MockWebSocket.OPEN) {\n              // Send many messages rapidly\n              for (let i = 0; i < 10; i++) {\n                ws.simulateMessage({\n                  type: 'notification',\n                  payload: {\n                    id: i.toString(),\n                    message: `Message ${i}`,\n                    type: 'info'\n                  }\n                })\n              }\n            }\n          }, 50)\n        }, [])\n\n        return <MockLiveUpdatesComponent socket={socket} isConnected={true} />\n      }\n\n      const startTime = performance.now()\n      \n      render(<TestComponent />)\n\n      // Wait for messages to be processed\n      await waitFor(() => {\n        expect(screen.getAllByTestId(/notification-/).length).toBeGreaterThanOrEqual(10)\n      }, { timeout: 3000 })\n\n      const endTime = performance.now()\n      const processingTime = endTime - startTime\n\n      // Should process messages reasonably quickly\n      expect(processingTime).toBeLessThan(3000)\n    })\n  })\n})\n"],"names":["MockWebSocketInstances","MockWebSocket","CONNECTING","OPEN","CLOSING","CLOSED","url","readyState","onopen","onclose","onmessage","onerror","push","setTimeout","Event","send","data","Error","MessageEvent","close","CloseEvent","simulateMessage","JSON","stringify","simulateError","simulateClose","MockWebSocketConstructor","jest","fn","mockImplementation","global","WebSocket","MockWebSocketProvider","children","socket","setSocket","React","useState","isConnected","setIsConnected","connectionStatus","setConnectionStatus","connect","useCallback","ws","useEffect","disconnect","sendMessage","message","contextValue","div","data-testid","Children","map","child","isValidElement","cloneElement","MockChatComponent","messages","setMessages","inputValue","setInputValue","handleMessage","event","parse","type","prev","payload","error","console","handleSendMessage","trim","id","Date","now","toString","content","author","timestamp","toISOString","msg","strong","input","value","onChange","e","target","onKeyPress","key","disabled","placeholder","button","onClick","MockLiveUpdatesComponent","posts","setPosts","notifications","setNotifications","post","title","notification","describe","beforeEach","clearAllMocks","length","it","render","expect","screen","getByTestId","toBeInTheDocument","waitFor","toHaveBeenCalledWith","timeout","toHaveTextContent","TestComponent","setError","provider","act","mockSocket","user","userEvent","setup","sendButton","click","messagesContainer","toBeGreaterThan","getByText","toHaveValue","toBeDisabled","not","testSocket","queryByText","consoleSpy","spyOn","any","mockRestore","i","startTime","performance","getAllByTestId","toBeGreaterThanOrEqual","endTime","processingTime","toBeLessThan"],"mappings":"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"}