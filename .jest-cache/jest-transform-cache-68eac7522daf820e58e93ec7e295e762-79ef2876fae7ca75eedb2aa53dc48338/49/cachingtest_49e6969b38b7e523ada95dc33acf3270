c765b7bf4e3edf63d01c1fe66e5af983
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _caching = require("../../utils/caching");
// Mock localStorage and sessionStorage
const mockStorage = ()=>({
        getItem: jest.fn(),
        setItem: jest.fn(),
        removeItem: jest.fn(),
        clear: jest.fn(),
        length: 0,
        key: jest.fn()
    });
Object.defineProperty(window, 'localStorage', {
    value: mockStorage()
});
Object.defineProperty(window, 'sessionStorage', {
    value: mockStorage()
});
describe('Caching Utilities', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
        _caching.apiCache.clear();
    });
    describe('MemoryCache', ()=>{
        it('stores and retrieves data', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            expect(cache.get('key1')).toBe('value1');
        });
        it('respects TTL expiration', async ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 50,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            expect(cache.get('key1')).toBe('value1');
            // Wait for TTL to expire
            await new Promise((resolve)=>setTimeout(resolve, 100));
            expect(cache.get('key1')).toBeNull();
        });
        it('enforces max size limit', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 2
            });
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            cache.set('key3', 'value3'); // Should evict key1
            expect(cache.get('key1')).toBeNull();
            expect(cache.get('key2')).toBe('value2');
            expect(cache.get('key3')).toBe('value3');
        });
        it('tracks hit counts', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            cache.get('key1');
            cache.get('key1');
            const stats = cache.getStats();
            expect(stats.entries[0].hits).toBe(2);
        });
        it('deletes specific keys', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            expect(cache.delete('key1')).toBe(true);
            expect(cache.get('key1')).toBeNull();
            expect(cache.get('key2')).toBe('value2');
        });
        it('clears all data', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            cache.clear();
            expect(cache.get('key1')).toBeNull();
            expect(cache.get('key2')).toBeNull();
            expect(cache.size()).toBe(0);
        });
    });
    describe('withCache decorator', ()=>{
        it('caches function results', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            const mockFn = jest.fn().mockReturnValue('result');
            const cachedFn = (0, _caching.withCache)(mockFn, cache);
            // First call
            expect(cachedFn('arg1')).toBe('result');
            expect(mockFn).toHaveBeenCalledTimes(1);
            // Second call should use cache
            expect(cachedFn('arg1')).toBe('result');
            expect(mockFn).toHaveBeenCalledTimes(1);
            // Different args should call function again
            expect(cachedFn('arg2')).toBe('result');
            expect(mockFn).toHaveBeenCalledTimes(2);
        });
        it('handles async functions', async ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            const mockAsyncFn = jest.fn().mockResolvedValue('async result');
            const cachedFn = (0, _caching.withCache)(mockAsyncFn, cache);
            // First call
            const result1 = await cachedFn('arg1');
            expect(result1).toBe('async result');
            expect(mockAsyncFn).toHaveBeenCalledTimes(1);
            // Second call should use cache
            const result2 = await cachedFn('arg1');
            expect(result2).toBe('async result');
            expect(mockAsyncFn).toHaveBeenCalledTimes(1);
        });
        it('uses custom key generator', ()=>{
            const cache = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            const mockFn = jest.fn().mockReturnValue('result');
            const keyGen = jest.fn().mockReturnValue('custom-key');
            const cachedFn = (0, _caching.withCache)(mockFn, cache, keyGen);
            cachedFn('arg1', 'arg2');
            expect(keyGen).toHaveBeenCalledWith('arg1', 'arg2');
            expect(cache.has('custom-key')).toBe(true);
        });
    });
    describe('StorageCache', ()=>{
        it('uses localStorage correctly', ()=>{
            const mockGetItem = jest.fn();
            const mockSetItem = jest.fn();
            Object.defineProperty(window, 'localStorage', {
                value: {
                    ...mockStorage(),
                    getItem: mockGetItem,
                    setItem: mockSetItem
                }
            });
            const cache = (0, _caching.createCache)('localStorage', {
                ttl: 1000,
                maxSize: 10
            });
            // Mock successful storage
            mockGetItem.mockReturnValue(JSON.stringify({
                data: 'stored value',
                timestamp: Date.now(),
                ttl: 1000,
                hits: 0
            }));
            cache.set('key1', 'value1');
            expect(mockSetItem).toHaveBeenCalled();
            const result = cache.get('key1');
            expect(mockGetItem).toHaveBeenCalledWith('robot-overlord:key1');
        });
        it('handles storage errors gracefully', ()=>{
            const mockSetItem = jest.fn().mockImplementation(()=>{
                throw new Error('Storage quota exceeded');
            });
            Object.defineProperty(window, 'localStorage', {
                value: {
                    ...mockStorage(),
                    setItem: mockSetItem
                }
            });
            const cache = (0, _caching.createCache)('localStorage', {
                ttl: 1000,
                maxSize: 10
            });
            // Should not throw error
            expect(()=>cache.set('key1', 'value1')).not.toThrow();
        });
        it('falls back to memory cache when storage unavailable', ()=>{
            // Simulate server-side environment
            const originalWindow = global.window;
            delete global.window;
            const cache = (0, _caching.createCache)('localStorage', {
                ttl: 1000,
                maxSize: 10
            });
            cache.set('key1', 'value1');
            expect(cache.get('key1')).toBe('value1');
            // Restore window
            global.window = originalWindow;
        });
    });
    describe('Predefined caches', ()=>{
        it('apiCache works correctly', ()=>{
            _caching.apiCache.set('api-key', {
                data: 'api response'
            });
            expect(_caching.apiCache.get('api-key')).toEqual({
                data: 'api response'
            });
        });
        it('different cache instances are isolated', ()=>{
            const cache1 = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            const cache2 = (0, _caching.createCache)('memory', {
                ttl: 1000,
                maxSize: 10
            });
            cache1.set('key1', 'value1');
            cache2.set('key1', 'value2');
            expect(cache1.get('key1')).toBe('value1');
            expect(cache2.get('key1')).toBe('value2');
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb3Noc3plcC9jb2RlL3RoZXJvYm90b3ZlcmxvcmQtbW9uby90aGVyb2JvdG92ZXJsb3JkLXdlYi9zcmMvX190ZXN0c19fL3V0aWxzL2NhY2hpbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDYWNoZSwgd2l0aENhY2hlLCBhcGlDYWNoZSB9IGZyb20gJ0AvdXRpbHMvY2FjaGluZydcblxuLy8gTW9jayBsb2NhbFN0b3JhZ2UgYW5kIHNlc3Npb25TdG9yYWdlXG5jb25zdCBtb2NrU3RvcmFnZSA9ICgpID0+ICh7XG4gIGdldEl0ZW06IGplc3QuZm4oKSxcbiAgc2V0SXRlbTogamVzdC5mbigpLFxuICByZW1vdmVJdGVtOiBqZXN0LmZuKCksXG4gIGNsZWFyOiBqZXN0LmZuKCksXG4gIGxlbmd0aDogMCxcbiAga2V5OiBqZXN0LmZuKClcbn0pXG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7IHZhbHVlOiBtb2NrU3RvcmFnZSgpIH0pXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc2Vzc2lvblN0b3JhZ2UnLCB7IHZhbHVlOiBtb2NrU3RvcmFnZSgpIH0pXG5cbmRlc2NyaWJlKCdDYWNoaW5nIFV0aWxpdGllcycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKClcbiAgICBhcGlDYWNoZS5jbGVhcigpXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ01lbW9yeUNhY2hlJywgKCkgPT4ge1xuICAgIGl0KCdzdG9yZXMgYW5kIHJldHJpZXZlcyBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGUgPSBjcmVhdGVDYWNoZSgnbWVtb3J5JywgeyB0dGw6IDEwMDAsIG1heFNpemU6IDEwIH0pXG4gICAgICBcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKVxuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTEnKVxuICAgIH0pXG5cbiAgICBpdCgncmVzcGVjdHMgVFRMIGV4cGlyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdtZW1vcnknLCB7IHR0bDogNTAsIG1heFNpemU6IDEwIH0pXG4gICAgICBcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKVxuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTEnKVxuICAgICAgXG4gICAgICAvLyBXYWl0IGZvciBUVEwgdG8gZXhwaXJlXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSlcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTEnKSkudG9CZU51bGwoKVxuICAgIH0pXG5cbiAgICBpdCgnZW5mb3JjZXMgbWF4IHNpemUgbGltaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdtZW1vcnknLCB7IHR0bDogMTAwMCwgbWF4U2l6ZTogMiB9KVxuICAgICAgXG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJylcbiAgICAgIGNhY2hlLnNldCgna2V5MicsICd2YWx1ZTInKVxuICAgICAgY2FjaGUuc2V0KCdrZXkzJywgJ3ZhbHVlMycpIC8vIFNob3VsZCBldmljdCBrZXkxXG4gICAgICBcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTEnKSkudG9CZU51bGwoKVxuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MicpKS50b0JlKCd2YWx1ZTInKVxuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MycpKS50b0JlKCd2YWx1ZTMnKVxuICAgIH0pXG5cbiAgICBpdCgndHJhY2tzIGhpdCBjb3VudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdtZW1vcnknLCB7IHR0bDogMTAwMCwgbWF4U2l6ZTogMTAgfSlcbiAgICAgIFxuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpXG4gICAgICBjYWNoZS5nZXQoJ2tleTEnKVxuICAgICAgY2FjaGUuZ2V0KCdrZXkxJylcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjYWNoZS5nZXRTdGF0cygpXG4gICAgICBleHBlY3Qoc3RhdHMuZW50cmllc1swXS5oaXRzKS50b0JlKDIpXG4gICAgfSlcblxuICAgIGl0KCdkZWxldGVzIHNwZWNpZmljIGtleXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdtZW1vcnknLCB7IHR0bDogMTAwMCwgbWF4U2l6ZTogMTAgfSlcbiAgICAgIFxuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpXG4gICAgICBjYWNoZS5zZXQoJ2tleTInLCAndmFsdWUyJylcbiAgICAgIFxuICAgICAgZXhwZWN0KGNhY2hlLmRlbGV0ZSgna2V5MScpKS50b0JlKHRydWUpXG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmVOdWxsKClcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTInKSkudG9CZSgndmFsdWUyJylcbiAgICB9KVxuXG4gICAgaXQoJ2NsZWFycyBhbGwgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlID0gY3JlYXRlQ2FjaGUoJ21lbW9yeScsIHsgdHRsOiAxMDAwLCBtYXhTaXplOiAxMCB9KVxuICAgICAgXG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJylcbiAgICAgIGNhY2hlLnNldCgna2V5MicsICd2YWx1ZTInKVxuICAgICAgY2FjaGUuY2xlYXIoKVxuICAgICAgXG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmVOdWxsKClcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTInKSkudG9CZU51bGwoKVxuICAgICAgZXhwZWN0KGNhY2hlLnNpemUoKSkudG9CZSgwKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ3dpdGhDYWNoZSBkZWNvcmF0b3InLCAoKSA9PiB7XG4gICAgaXQoJ2NhY2hlcyBmdW5jdGlvbiByZXN1bHRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGUgPSBjcmVhdGVDYWNoZSgnbWVtb3J5JywgeyB0dGw6IDEwMDAsIG1heFNpemU6IDEwIH0pXG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdyZXN1bHQnKVxuICAgICAgY29uc3QgY2FjaGVkRm4gPSB3aXRoQ2FjaGUobW9ja0ZuLCBjYWNoZSlcbiAgICAgIFxuICAgICAgLy8gRmlyc3QgY2FsbFxuICAgICAgZXhwZWN0KGNhY2hlZEZuKCdhcmcxJykpLnRvQmUoJ3Jlc3VsdCcpXG4gICAgICBleHBlY3QobW9ja0ZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSlcbiAgICAgIFxuICAgICAgLy8gU2Vjb25kIGNhbGwgc2hvdWxkIHVzZSBjYWNoZVxuICAgICAgZXhwZWN0KGNhY2hlZEZuKCdhcmcxJykpLnRvQmUoJ3Jlc3VsdCcpXG4gICAgICBleHBlY3QobW9ja0ZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSlcbiAgICAgIFxuICAgICAgLy8gRGlmZmVyZW50IGFyZ3Mgc2hvdWxkIGNhbGwgZnVuY3Rpb24gYWdhaW5cbiAgICAgIGV4cGVjdChjYWNoZWRGbignYXJnMicpKS50b0JlKCdyZXN1bHQnKVxuICAgICAgZXhwZWN0KG1vY2tGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpXG4gICAgfSlcblxuICAgIGl0KCdoYW5kbGVzIGFzeW5jIGZ1bmN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlID0gY3JlYXRlQ2FjaGUoJ21lbW9yeScsIHsgdHRsOiAxMDAwLCBtYXhTaXplOiAxMCB9KVxuICAgICAgY29uc3QgbW9ja0FzeW5jRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ2FzeW5jIHJlc3VsdCcpXG4gICAgICBjb25zdCBjYWNoZWRGbiA9IHdpdGhDYWNoZShtb2NrQXN5bmNGbiwgY2FjaGUpXG4gICAgICBcbiAgICAgIC8vIEZpcnN0IGNhbGxcbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBhd2FpdCBjYWNoZWRGbignYXJnMScpXG4gICAgICBleHBlY3QocmVzdWx0MSkudG9CZSgnYXN5bmMgcmVzdWx0JylcbiAgICAgIGV4cGVjdChtb2NrQXN5bmNGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpXG4gICAgICBcbiAgICAgIC8vIFNlY29uZCBjYWxsIHNob3VsZCB1c2UgY2FjaGVcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBjYWNoZWRGbignYXJnMScpXG4gICAgICBleHBlY3QocmVzdWx0MikudG9CZSgnYXN5bmMgcmVzdWx0JylcbiAgICAgIGV4cGVjdChtb2NrQXN5bmNGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpXG4gICAgfSlcblxuICAgIGl0KCd1c2VzIGN1c3RvbSBrZXkgZ2VuZXJhdG9yJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGUgPSBjcmVhdGVDYWNoZSgnbWVtb3J5JywgeyB0dGw6IDEwMDAsIG1heFNpemU6IDEwIH0pXG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdyZXN1bHQnKVxuICAgICAgY29uc3Qga2V5R2VuID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnY3VzdG9tLWtleScpXG4gICAgICBjb25zdCBjYWNoZWRGbiA9IHdpdGhDYWNoZShtb2NrRm4sIGNhY2hlLCBrZXlHZW4pXG4gICAgICBcbiAgICAgIGNhY2hlZEZuKCdhcmcxJywgJ2FyZzInKVxuICAgICAgXG4gICAgICBleHBlY3Qoa2V5R2VuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYXJnMScsICdhcmcyJylcbiAgICAgIGV4cGVjdChjYWNoZS5oYXMoJ2N1c3RvbS1rZXknKSkudG9CZSh0cnVlKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ1N0b3JhZ2VDYWNoZScsICgpID0+IHtcbiAgICBpdCgndXNlcyBsb2NhbFN0b3JhZ2UgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0dldEl0ZW0gPSBqZXN0LmZuKClcbiAgICAgIGNvbnN0IG1vY2tTZXRJdGVtID0gamVzdC5mbigpXG4gICAgICBcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7XG4gICAgICAgIHZhbHVlOiB7IC4uLm1vY2tTdG9yYWdlKCksIGdldEl0ZW06IG1vY2tHZXRJdGVtLCBzZXRJdGVtOiBtb2NrU2V0SXRlbSB9XG4gICAgICB9KVxuICAgICAgXG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdsb2NhbFN0b3JhZ2UnLCB7IHR0bDogMTAwMCwgbWF4U2l6ZTogMTAgfSlcbiAgICAgIFxuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIHN0b3JhZ2VcbiAgICAgIG1vY2tHZXRJdGVtLm1vY2tSZXR1cm5WYWx1ZShKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGRhdGE6ICdzdG9yZWQgdmFsdWUnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIHR0bDogMTAwMCxcbiAgICAgICAgaGl0czogMFxuICAgICAgfSkpXG4gICAgICBcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKVxuICAgICAgZXhwZWN0KG1vY2tTZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gY2FjaGUuZ2V0KCdrZXkxJylcbiAgICAgIGV4cGVjdChtb2NrR2V0SXRlbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3JvYm90LW92ZXJsb3JkOmtleTEnKVxuICAgIH0pXG5cbiAgICBpdCgnaGFuZGxlcyBzdG9yYWdlIGVycm9ycyBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1NldEl0ZW0gPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdG9yYWdlIHF1b3RhIGV4Y2VlZGVkJylcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7XG4gICAgICAgIHZhbHVlOiB7IC4uLm1vY2tTdG9yYWdlKCksIHNldEl0ZW06IG1vY2tTZXRJdGVtIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGNvbnN0IGNhY2hlID0gY3JlYXRlQ2FjaGUoJ2xvY2FsU3RvcmFnZScsIHsgdHRsOiAxMDAwLCBtYXhTaXplOiAxMCB9KVxuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IHRocm93IGVycm9yXG4gICAgICBleHBlY3QoKCkgPT4gY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpKS5ub3QudG9UaHJvdygpXG4gICAgfSlcblxuICAgIGl0KCdmYWxscyBiYWNrIHRvIG1lbW9yeSBjYWNoZSB3aGVuIHN0b3JhZ2UgdW5hdmFpbGFibGUnLCAoKSA9PiB7XG4gICAgICAvLyBTaW11bGF0ZSBzZXJ2ZXItc2lkZSBlbnZpcm9ubWVudFxuICAgICAgY29uc3Qgb3JpZ2luYWxXaW5kb3cgPSBnbG9iYWwud2luZG93XG4gICAgICBkZWxldGUgKGdsb2JhbCBhcyBhbnkpLndpbmRvd1xuICAgICAgXG4gICAgICBjb25zdCBjYWNoZSA9IGNyZWF0ZUNhY2hlKCdsb2NhbFN0b3JhZ2UnLCB7IHR0bDogMTAwMCwgbWF4U2l6ZTogMTAgfSlcbiAgICAgIFxuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpXG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmUoJ3ZhbHVlMScpXG4gICAgICBcbiAgICAgIC8vIFJlc3RvcmUgd2luZG93XG4gICAgICBnbG9iYWwud2luZG93ID0gb3JpZ2luYWxXaW5kb3dcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdQcmVkZWZpbmVkIGNhY2hlcycsICgpID0+IHtcbiAgICBpdCgnYXBpQ2FjaGUgd29ya3MgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgYXBpQ2FjaGUuc2V0KCdhcGkta2V5JywgeyBkYXRhOiAnYXBpIHJlc3BvbnNlJyB9KVxuICAgICAgZXhwZWN0KGFwaUNhY2hlLmdldCgnYXBpLWtleScpKS50b0VxdWFsKHsgZGF0YTogJ2FwaSByZXNwb25zZScgfSlcbiAgICB9KVxuXG4gICAgaXQoJ2RpZmZlcmVudCBjYWNoZSBpbnN0YW5jZXMgYXJlIGlzb2xhdGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGUxID0gY3JlYXRlQ2FjaGUoJ21lbW9yeScsIHsgdHRsOiAxMDAwLCBtYXhTaXplOiAxMCB9KVxuICAgICAgY29uc3QgY2FjaGUyID0gY3JlYXRlQ2FjaGUoJ21lbW9yeScsIHsgdHRsOiAxMDAwLCBtYXhTaXplOiAxMCB9KVxuICAgICAgXG4gICAgICBjYWNoZTEuc2V0KCdrZXkxJywgJ3ZhbHVlMScpXG4gICAgICBjYWNoZTIuc2V0KCdrZXkxJywgJ3ZhbHVlMicpXG4gICAgICBcbiAgICAgIGV4cGVjdChjYWNoZTEuZ2V0KCdrZXkxJykpLnRvQmUoJ3ZhbHVlMScpXG4gICAgICBleHBlY3QoY2FjaGUyLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTInKVxuICAgIH0pXG4gIH0pXG59KVxuIl0sIm5hbWVzIjpbIm1vY2tTdG9yYWdlIiwiZ2V0SXRlbSIsImplc3QiLCJmbiIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiY2xlYXIiLCJsZW5ndGgiLCJrZXkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsIndpbmRvdyIsInZhbHVlIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsImFwaUNhY2hlIiwiaXQiLCJjYWNoZSIsImNyZWF0ZUNhY2hlIiwidHRsIiwibWF4U2l6ZSIsInNldCIsImV4cGVjdCIsImdldCIsInRvQmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ0b0JlTnVsbCIsInN0YXRzIiwiZ2V0U3RhdHMiLCJlbnRyaWVzIiwiaGl0cyIsImRlbGV0ZSIsInNpemUiLCJtb2NrRm4iLCJtb2NrUmV0dXJuVmFsdWUiLCJjYWNoZWRGbiIsIndpdGhDYWNoZSIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyIsIm1vY2tBc3luY0ZuIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJyZXN1bHQxIiwicmVzdWx0MiIsImtleUdlbiIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiaGFzIiwibW9ja0dldEl0ZW0iLCJtb2NrU2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInRvSGF2ZUJlZW5DYWxsZWQiLCJyZXN1bHQiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJFcnJvciIsIm5vdCIsInRvVGhyb3ciLCJvcmlnaW5hbFdpbmRvdyIsImdsb2JhbCIsInRvRXF1YWwiLCJjYWNoZTEiLCJjYWNoZTIiXSwibWFwcGluZ3MiOiI7Ozs7eUJBQWlEO0FBRWpELHVDQUF1QztBQUN2QyxNQUFNQSxjQUFjLElBQU8sQ0FBQTtRQUN6QkMsU0FBU0MsS0FBS0MsRUFBRTtRQUNoQkMsU0FBU0YsS0FBS0MsRUFBRTtRQUNoQkUsWUFBWUgsS0FBS0MsRUFBRTtRQUNuQkcsT0FBT0osS0FBS0MsRUFBRTtRQUNkSSxRQUFRO1FBQ1JDLEtBQUtOLEtBQUtDLEVBQUU7SUFDZCxDQUFBO0FBRUFNLE9BQU9DLGNBQWMsQ0FBQ0MsUUFBUSxnQkFBZ0I7SUFBRUMsT0FBT1o7QUFBYztBQUNyRVMsT0FBT0MsY0FBYyxDQUFDQyxRQUFRLGtCQUFrQjtJQUFFQyxPQUFPWjtBQUFjO0FBRXZFYSxTQUFTLHFCQUFxQjtJQUM1QkMsV0FBVztRQUNUWixLQUFLYSxhQUFhO1FBQ2xCQyxpQkFBUSxDQUFDVixLQUFLO0lBQ2hCO0lBRUFPLFNBQVMsZUFBZTtRQUN0QkksR0FBRyw2QkFBNkI7WUFDOUIsTUFBTUMsUUFBUUMsSUFBQUEsb0JBQVcsRUFBQyxVQUFVO2dCQUFFQyxLQUFL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